<%#
---
title: Multiselect (Tags)
description: Use tailwind classes with mini js to show a multiselect input.
---
%>

<script>
  allOptions = ["ğŸ’ Cherry", "ğŸ Apple", "ğŸ« Blueberry", "ğŸŒ Banana", "ğŸ“ Strawberry", "ğŸ¥ Kiwi", "ğŸŠ Orange", "ğŸ Pear", "ğŸ Pineapple", "ğŸ‘ Peach"];
  filteredTags = [];
  selectedOptions = [];
  selectedOption = null;
  searchQuery = "";
</script>


<!-- Multiselect Menu -->
<div class="relative w-64" :clickout="showOptions = false">
  <!-- Multiselect Menu Input -->
  <div class="space-y-1">
    <label class="font-medium text-gray-700" for="multiselect-menu">Add ingredients:</label>
    <div
      class="relative w-full cursor-default rounded-lg"
    >
      <form onsubmit="event.preventDefault();" class="relative w-64">
        <input
          id="multiselect-menu"
          type="text"
          autocomplete="off"
          class="group flex w-full items-center justify-between gap-2 rounded-lg border border-gray-200 bg-white px-3 py-2 text-left leading-6 hover:border-gray-300 shadow-sm"
          placeholder="Ingredient search..."
          :change="searchQuery = this.value;
          filteredTags = allOptions.subtract(selectedOptions).search(searchQuery);
          selectedOption = filteredTags.first
          "
          :keyup.enter="selectedOptions = selectedOptions.add(selectedOption);
          filteredTags = filteredTags.remove(selectedOption);
          selectedOption = filteredTags.first"
          :keyup.up="selectedOption = filteredTags.previousItem(selectedOption)"
          :keyup.down="selectedOption = filteredTags.nextItem(selectedOption)"
          :click="showOptions = true"
          :focus="showOptions = true; filteredTags = allOptions.subtract(selectedOptions).search(searchQuery); selectedOption = filteredTags.first"
        />
      </form>
    </div>
  </div>

  <div
    class="absolute opacity-0 w-64 transition origin-top ease-out duration-100 inset-x-0 z-10 mt-2 max-h-60 overflow-y-auto rounded-lg bg-white py-2.5 shadow-xl border border-gray-200"
    aria-labelledby="multiselect-menu"
    aria-orientation="vertical"
    role="combobox"
    tabindex="0"
    :class="showOptions ? 'transform opacity-100 scale-100' : 'transform scale-95 opacity-0 pointer-events-none' "
    :class="filteredTags.length ? '' : 'hidden' "
    <%# Make it so this element doesn't disturb the selected ingredients under%>
  >
    <div
      :each="tag in filteredTags"
      class="group items-center justify-between gap-2 border-y border-transparent text-sm text-gray-900"
      :class="filteredTags.length ? '' : 'hidden' "
    >
      <button
        :click="selectedOptions = selectedOptions.add(tag);
        filteredTags = filteredTags.remove(selectedOption);
        selectedOption = filteredTags.first"
        :mouseover="selectedOption = tag"
        :class="selectedOption == tag ? 'bg-gray-100 text-gray-700' : 'text-gray-700'"
        class="grow truncate py-1.5 px-2 cursor-pointer w-full text-left"
        role="option"
        >
        <span :text="tag" class="select-none"></span>
      </button>
    </div>
    <span
      :class="filteredTags == 0 ? '' : 'hidden' "
      class="px-3 text-sm text-gray-500"
      :text="selectedOptions.length < allOptions.length ? 'No result found' : 'No ingredients left ğŸ˜‹' "
    >
      No ingredients left ğŸ˜‹ OR No ingredient found
    </span>
  </div>
</div>

<div class="mt-2">
  <p class="font-medium text-gray-700 py-1">Selected Ingredients:</p>
  <div :each="tag in selectedOptions" class="hidden flex-wrap gap-2" :class="selectedOptions.length == 0 ? 'hidden' : 'flex' ">
    <div class="inline-flex items-center justify-between gap-x-1 rounded-md bg-gray-50 pl-2 pr-1.5 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-200">
      <span :text="tag"></span>
      <button
        type="button"
        class="relative h-3 w-3 rounded-sm hover:bg-gray-200"
        :click="selectedOptions = selectedOptions.remove(tag);
            filteredTags = allOptions.subtract(selectedOptions).search(searchQuery);
            selectedOption = filteredTags.first"
            >
        <span class="sr-only">Remove</span>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="text-gray-600" class="w-3 h-3">
          <path d="M5.28 4.22a.75.75 0 0 0-1.06 1.06L6.94 8l-2.72 2.72a.75.75 0 1 0 1.06 1.06L8 9.06l2.72 2.72a.75.75 0 1 0 1.06-1.06L9.06 8l2.72-2.72a.75.75 0 0 0-1.06-1.06L8 6.94 5.28 4.22Z" />
        </svg>

        <span class="absolute -inset-1"></span>
      </button>
    </div>
  </div>
</div>
